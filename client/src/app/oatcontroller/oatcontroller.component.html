<div class="controller-container">
  <!-- Connection & Device Status Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Connection & Device Status</mat-card-title>
      <mat-card-subtitle>
        <span [class]="isConnected ? 'status-connected' : 'status-disconnected'">
          {{ isConnected ? 'Connected' : 'Disconnected' }}
        </span>
        <span *ngIf="isConnected" [class]="isTracking ? 'status-tracking' : 'status-stopped'">
          • {{ isTracking ? 'Tracking' : 'Stopped' }}
        </span>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <button mat-raised-button 
              [color]="isTracking ? 'warn' : 'accent'" 
              (click)="toggleTracking()" 
              [disabled]="!isConnected || isIndiConnected">
        <mat-icon>{{ isTracking ? 'pause' : 'play_arrow' }}</mat-icon>
        {{ isTracking ? 'Stop Tracking' : 'Start Tracking' }}
      </button>
      
      <div class="device-status">
        <div class="device-item">
          <mat-icon [class]="cameraStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ cameraStatus.connected ? 'camera_alt' : 'camera_alt' }}
          </mat-icon>
          <span>Camera: </span>
          <span [class]="cameraStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ cameraStatus.connected ? (cameraStatus.device || 'Connected') : 'Not configured' }}
          </span>
        </div>
        <div class="device-item">
          <mat-icon [class]="guiderStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ guiderStatus.connected ? 'gps_fixed' : 'gps_off' }}
          </mat-icon>
          <span>Guider: </span>
          <span [class]="guiderStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ guiderStatus.connected ? (guiderStatus.device || 'Connected') : 'Not configured' }}
          </span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Home & Park Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Home & Park</mat-card-title>
      <mat-card-subtitle>Home position and parking controls</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="button-grid">
        <button mat-raised-button color="accent" (click)="homeRA()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home</mat-icon>
          Home RA
        </button>
        <button mat-raised-button color="accent" (click)="homeDEC()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home</mat-icon>
          Home DEC
        </button>
        <button mat-raised-button color="primary" (click)="setHome()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>flag</mat-icon>
          Set Home
        </button>
        <button mat-raised-button color="primary" (click)="gotoHome()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home_work</mat-icon>
          Go to Home
        </button>
        <button mat-raised-button color="warn" (click)="park()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>local_parking</mat-icon>
          Park
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Position Card -->
  <mat-card class="status-card">
    <mat-card-header>
      <mat-card-title>Mount Position</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <app-coordinate-display [ra]="currentPosition.ra" [dec]="currentPosition.dec"></app-coordinate-display>
      <button mat-raised-button color="primary" (click)="updatePosition()">
        <mat-icon>refresh</mat-icon>
        Refresh Position
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Target Selection Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Target Selection/Coordinate Input</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="targetForm" (ngSubmit)="setTarget()" class="target-form">
        <mat-form-field>
          <mat-label>RA</mat-label>
          <input matInput formControlName="ra" placeholder="12:34:56">
        </mat-form-field>
        <mat-form-field>
          <mat-label>DEC</mat-label>
          <input matInput formControlName="dec" placeholder="+45:30:00">
        </mat-form-field>
        
        <button mat-raised-button color="primary" type="submit" [disabled]="!isConnected || !targetForm.valid || isIndiConnected">
          <mat-icon>my_location</mat-icon>
          Set Target
        </button>
        
        <button mat-raised-button color="accent" (click)="slew()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>navigation</mat-icon>
          Slew to Target
        </button>
        
        <button mat-raised-button color="primary" (click)="openObjectDialog()">
          <mat-icon>star</mat-icon>
          Select from Catalog
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Manual Control Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Manual Control</mat-card-title>
      <mat-card-subtitle>Manual mount movements</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="manual-controls">
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('north')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_up</mat-icon>
          </button>
        </div>
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('west')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_left</mat-icon>
          </button>
          <button mat-fab color="warn" (click)="manualMove('stop')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>stop</mat-icon>
          </button>
          <button mat-fab color="primary" (click)="manualMove('east')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
        </div>
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('south')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_down</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- INDI Server Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>INDI Server</mat-card-title>
      <mat-card-subtitle>
        <span [class]="isIndiServerRunning ? 'status-connected' : 'status-disconnected'">
          Server: {{ isIndiServerRunning ? 'Running' : 'Stopped' }}
        </span>
        <span *ngIf="isIndiServerRunning" [class]="isIndiConnected ? 'status-connected' : 'status-disconnected'">
          • {{ isIndiConnected ? 'Connected' : 'Disconnected' }}
        </span>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="button-grid">
        <button mat-raised-button color="accent" (click)="startIndiServer()" [disabled]="isIndiServerRunning">
          <mat-icon>play_arrow</mat-icon>
          Start Server
        </button>
        <button mat-raised-button color="warn" (click)="stopIndiServer()" [disabled]="!isIndiServerRunning">
          <mat-icon>stop</mat-icon>
          Stop Server
        </button>
        <button mat-raised-button 
                [color]="isIndiConnected ? 'warn' : 'primary'" 
                (click)="toggleIndiConnection()"
                [disabled]="!isIndiServerRunning">
          <mat-icon>{{ isIndiConnected ? 'link_off' : 'link' }}</mat-icon>
          {{ isIndiConnected ? 'Disconnect Mount' : 'Connect Mount' }}
        </button>
        <a mat-raised-button href="/indi" target="_blank" [class.disabled]="!isIndiServerRunning">
          <mat-icon>web</mat-icon>
          Web Manager
        </a>
      </div>
    </mat-card-content>
  </mat-card>
</div>
