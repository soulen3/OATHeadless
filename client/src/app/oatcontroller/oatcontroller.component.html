<div class="controller-container">
  <!-- Position Card -->
  <mat-card class="status-card">
    <mat-card-header>
      <mat-card-title>Mount Position</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <app-coordinate-display [ra]="currentPosition.ra" [dec]="currentPosition.dec"></app-coordinate-display>
      <button mat-raised-button color="primary" (click)="updatePosition()">
        <mat-icon>refresh</mat-icon>
        Refresh Position
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Connection & Tracking Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Connection & Tracking</mat-card-title>
      <mat-card-subtitle>
        <span [class]="isConnected ? 'status-connected' : 'status-disconnected'">
          {{ isConnected ? 'Connected' : 'Disconnected' }}
        </span>
        <span *ngIf="isConnected" [class]="isTracking ? 'status-tracking' : 'status-stopped'">
          â€¢ {{ isTracking ? 'Tracking' : 'Stopped' }}
        </span>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <button mat-raised-button 
              [color]="isTracking ? 'warn' : 'accent'" 
              (click)="toggleTracking()" 
              [disabled]="!isConnected || isIndiConnected">
        <mat-icon>{{ isTracking ? 'pause' : 'play_arrow' }}</mat-icon>
        {{ isTracking ? 'Stop Tracking' : 'Start Tracking' }}
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Device Status Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Device Status</mat-card-title>
      <mat-card-subtitle>Camera and guider connection status</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="device-status">
        <div class="device-item">
          <mat-icon [class]="cameraStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ cameraStatus.connected ? 'camera_alt' : 'camera_alt' }}
          </mat-icon>
          <span>Camera: </span>
          <span [class]="cameraStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ cameraStatus.connected ? (cameraStatus.device || 'Connected') : 'Not configured' }}
          </span>
        </div>
        <div class="device-item">
          <mat-icon [class]="guiderStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ guiderStatus.connected ? 'gps_fixed' : 'gps_off' }}
          </mat-icon>
          <span>Guider: </span>
          <span [class]="guiderStatus.connected ? 'status-connected' : 'status-disconnected'">
            {{ guiderStatus.connected ? (guiderStatus.device || 'Connected') : 'Not configured' }}
          </span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- INDI Server Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>INDI Server</mat-card-title>
      <mat-card-subtitle>
        <span [class]="isIndiConnected ? 'status-connected' : 'status-disconnected'">
          {{ isIndiConnected ? 'INDI Connected' : 'INDI Disconnected' }}
        </span>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <button mat-raised-button 
              [color]="isIndiConnected ? 'warn' : 'primary'" 
              (click)="toggleIndiConnection()">
        <mat-icon>{{ isIndiConnected ? 'link_off' : 'link' }}</mat-icon>
        {{ isIndiConnected ? 'Disconnect INDI' : 'Connect INDI' }}
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Home & Park Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Home & Park</mat-card-title>
      <mat-card-subtitle>Home position and parking controls</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="button-grid">
        <button mat-raised-button color="accent" (click)="homeRA()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home</mat-icon>
          Home RA
        </button>
        <button mat-raised-button color="accent" (click)="homeDEC()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home</mat-icon>
          Home DEC
        </button>
        <button mat-raised-button color="primary" (click)="setHome()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>flag</mat-icon>
          Set Home
        </button>
        <button mat-raised-button color="primary" (click)="gotoHome()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>home_work</mat-icon>
          Go to Home
        </button>
        <button mat-raised-button color="warn" (click)="park()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>local_parking</mat-icon>
          Park
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Target Selection Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Target Selection</mat-card-title>
      <mat-card-subtitle>Set target coordinates</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="targetForm" (ngSubmit)="setTarget()" class="target-form">
        <div class="coordinate-inputs">
          <div class="coordinate-input">
            <label>RA:</label>
            <input formControlName="ra" placeholder="12:34:56">
          </div>
          <div class="coordinate-input">
            <label>DEC:</label>
            <input formControlName="dec" placeholder="+45:30:00">
          </div>
        </div>
        
        <button mat-raised-button color="primary" type="submit" [disabled]="!isConnected || !targetForm.valid || isIndiConnected">
          <mat-icon>my_location</mat-icon>
          Set Target
        </button>
        
        <button mat-raised-button color="accent" (click)="slew()" [disabled]="!isConnected || isIndiConnected">
          <mat-icon>navigation</mat-icon>
          Slew to Target
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Manual Control Card -->
  <mat-card class="control-card">
    <mat-card-header>
      <mat-card-title>Manual Control</mat-card-title>
      <mat-card-subtitle>Manual mount movements</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="manual-controls">
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('north')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_up</mat-icon>
          </button>
        </div>
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('west')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_left</mat-icon>
          </button>
          <button mat-fab color="warn" (click)="manualMove('stop')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>stop</mat-icon>
          </button>
          <button mat-fab color="primary" (click)="manualMove('east')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
        </div>
        <div class="control-row">
          <button mat-fab color="primary" (click)="manualMove('south')" [disabled]="!isConnected || isIndiConnected">
            <mat-icon>keyboard_arrow_down</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
  <!-- Star Catalog Card -->
  <mat-card class="catalog-card">
    <mat-card-header>
      <mat-card-title>Star Catalog</mat-card-title>
      <mat-card-subtitle>Select targets from catalog</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="starCatalog" class="catalog-table">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let object">{{ object.name }}</td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let object">{{ object.type }}</td>
        </ng-container>

        <ng-container matColumnDef="magnitude">
          <th mat-header-cell *matHeaderCellDef>Mag</th>
          <td mat-cell *matCellDef="let object">{{ object.magnitude }}</td>
        </ng-container>

        <ng-container matColumnDef="coordinates">
          <th mat-header-cell *matHeaderCellDef>Coordinates</th>
          <td mat-cell *matCellDef="let object">{{ object.ra }} / {{ object.dec }}</td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let object">
            <button mat-icon-button color="primary" (click)="selectCatalogTarget(object)">
              <mat-icon>my_location</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
